flowchart TD
    %% 1. 交易发起阶段
    A[交易发起] --> A1[用户操作：在主播直播店铺选择饰品，执行租赁/打赏]
    A1 --> A2[平台响应：显示商品详情（价格、货币种类等），发起支付请求]

    %% 2. 支付请求信息捕获阶段
    A2 --> B[支付请求信息捕获]
    B --> B1[平台向服务端发送关键信息：<br>- 用户ID + 主播ID<br>- 商品信息（SKU、租赁期限等）<br>- 价格 + 货币种类]

    %% 3. PayPal支付订单创建阶段
    B1 --> C[调用PayPal Create Payment API]
    C --> C1[服务端通过PayPal REST API提交请求：<br>参数包含交易金额、币种、支付描述]
    C1 --> C2[接收PayPal响应，保存支付订单ID]

    %% 4. 支付页面重定向与用户授权阶段
    C2 --> D[重定向到PayPal支付页面（Redirect URL）]
    D --> D1[用户操作：在PayPal页面完成身份认证 + 授权支付]

    %% 5. PayPal支付确认回调阶段
    D1 --> E[PayPal支付确认回调（Execute Payment API）]
    E --> E1[PayPal回调至平台确认URL]
    E1 --> E2[平台调用Execute Payment API，确认支付并完成交易]

    %% 6. 分账和结算阶段
    E2 --> F[分账和结算]
    F --> F1[平台按分账规则分配支付金额（平台+主播比例）]
    F1 --> F2[可选API调用：Payout API（从平台账户向主播账户转佣金）]
    F2 --> F3[保存分账明细，更新主播账户余额]

    %% 7. 交易完成通知与实物交付阶段
    F3 --> G[交易完成通知与实物交付]
    G --> G1[平台发送通知：向用户推送Email/平台消息]
    G --> G2[实物交付：通过Steam系统将租赁饰品发放至用户账户]
